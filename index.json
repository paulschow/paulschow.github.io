[{"content":"Hello!\n","date":"23 December 2022","permalink":"/about/","section":"Paul's Projects","summary":"Hello!","title":"About"},{"content":"After building my QFH antenna, I became more interested in satellite communications. The QFH antenna works great for circularly polarized signals like weather satellites, but something like a yagi or log-periodic antenna is better for most sats, because it can be pointed directly at the sat.\nAfter a short break where I interned at Keysight Technologies then finished my last semester at school, I built a tape measure yagi for 145.8 MHz to receive ISS SSTV broadcasts. It works great for that, but after a few passes I started to wonder if there was a better way. Ideally, some way to track the sat with a computer, automatically. Commercial solutions exist of course, like the Yaesu G-5500. This is a bit expensive for my tastes, and meant for more permanent installations. SatNOGS is a great open-source solution, if you have access to a 3D printer and some parts. I still want to build the SatNOGS rotor, but first I wanted to see if I could build my own version cheaper.\n* I\u0026rsquo;ll tell you straight away that my solution ended up costing more than $25, but I think someone could make the same thing for $25.\nHardware # As with most projects these days, I started out by shopping around for parts. Eventually, I found a $25 pan and tilt solution, meant for mounting cameras from drones.\n   It seemed to me that if I could make the antenna light enough, I should be able to use something like this to point it wherever I want. I ordered one of these, and also some okay servos ($7.21) with metal mounting brackets ($3.74) in case I wanted to completely make my own solution.\nNaturally, the servos and brackets shipped about a week earlier than the $25 pan and tilt kit. I couldn\u0026rsquo;t be bothered to wait, so I got right to trying to make it all fit together.\n   Using a bunch of masking tape and an arduino, I began to test if these servos could even support a pvc tape measure antenna.\n   The answer: kinda. The azimuth control works fine, but the elevation struggles a lot. The PVC elbows add more weight than you would think, and make it hard to balance. The antenna has to be made of something lighter than PVC (measuring tape is still light enough).\nLarge antistatic tubes used to ship high-speed connectors in work well for this. They\u0026rsquo;re long enough, and very lightweight while still being rigid. If I was doing it again though, I would probably just use a cheap yardstick.\n   The servos have no problems moving an antistatic tube around.\n   It is a bit harder to attach the measuring tape to a square tube than it is to a pvc elbow. I used very cheap electrical tape for testing, but later actually used screws.\n   However, after finishing this I took a step back and decided to work on the software more. It\u0026rsquo;s a bit of a pain to have this huge antenna flailing around when your code has a bug in it.\nThe arduino servo library is simple enough, and worked well for my servos. I did find that the writeMicroseconds() function worked better for me than the write() function. I made a simple script to control the two servos over the serial terminal: servo_serial.ino.\nNormally, servos don\u0026rsquo;t give actual feedback of their position. If you use the read() function, it just returns the last value that was written to the servo. This can be useful in some cases, but I decided I wanted to have actual feedback. The servo uses a potentiometer internally to determine the position, and it\u0026rsquo;s a simple matter to attach another wire to the center terminal and read the current value using the analog input on the arduino. Credit to jes1510 on trossenrobotics.com for the complete tutorial.\nI cut some wires from broken computer fans and got to work.\n      Now I just hooked the sense wire up to an analog pin on the arduino and read the values. I found my servos typically read between 80 and 445.\nI determined an arrangement for the servos that I thought would be able to track the most satellites (more on this later): azimuth on bottom with elevation on top.\n   Yes, the tape on the bottom of the vice is really necessary.\nSoftware # Computer Side # Now for the actual satellite tracking. For this, I looked to SatNOGS, which also uses an arduino. Their code interprets serial commands sent using the Easycomm2 protocol, and translates them to stepper or dc motor movements. The key here is the Hamlib library for linux. This library includes commands which take output from other programs and use them to control antennas or radios. My favorite satellite tracking program on linux is Gpredict, which works great with Hamlib.\nSatNOGS uses the Easycomm2 serial protocol, which Hamlib supports. Then the commands are just sent through the serial port on the arduino and interpreted there.\nIt\u0026rsquo;s easy to set up Gpredict with Hamlib, once you understand what\u0026rsquo;s going on.\nFirst, set up a new rotator interface in Gpredict.    Name can be whatever you want, I chose \u0026ldquo;easycomm2\u0026rdquo;. Host is \u0026ldquo;localhost\u0026rdquo; unless you are doing this over a network. Port is \u0026ldquo;4533\u0026rdquo; by default, but you can change it.\nThen, just set up Hamlib to interpret the command.    The command for this is \u0026ldquo;rotctld\u0026rdquo; (Hamlib TCP rotator control daemon). Choose the Easycomm2 mode with \u0026ldquo;-m 202\u0026rdquo;. The serial baud rate is \u0026ldquo;-s 19200\u0026rdquo;, and the serial port for me is \u0026ldquo;-r /dev/ttyUSB0\u0026rdquo;. The full command is \u0026ldquo;rotctld -m 202 -s 19200 -r /dev/ttyUSB0\u0026rdquo;. There won\u0026rsquo;t be any output afterwards unless there is an error.\nNext, go to Gpredict and open up the antenna control module.\n   You will get an antenna control panel.\n   From here you can click \u0026ldquo;engage\u0026rdquo; to activate the interface we set up earlier, and then control the antenna any way you want! Select a satellite and then click \u0026ldquo;track\u0026rdquo; to track it. Firmware Side # Setting up the computer software is the easy part. Luckily people have done a lot of work on this before me, to make it as simple as it is. However, that\u0026rsquo;s pointless if the hardware doesn\u0026rsquo;t know how to interpret the commands. The SatNOGS program will interpret the commands correctly and output them so I can use them, but I still wanted to know what was actually being sent. This proved to be more difficult than I first imagined. I couldn\u0026rsquo;t just open up the serial monitor on the arduino IDE, because the serial port was already in use. I played around with a bunch of linux serial sniffers and bridges, but couldn\u0026rsquo;t find one that was extremely simple to set up. Eventually I found the best solution for me was to use a Bus Pirate set to UART monitor.    Now that I could see what the Easycomm2 mode was actually putting out, I could better understand it. In my screenshot, I was setting the azimuth to 180 and elevation to 45. Pretty simple.\nThe SatNOGS stepper_motor_controller.ino already interprets Easycomm2 commands and then translates them into stepper motor controls. The key is the cmd_proc function, which eventually feeds the angles into the deg2step function to calculate the number of steps from degrees, and then feeds that into the stepper_move function. Since the servos don\u0026rsquo;t need step calculation, I just cut that out and made my own servo_move function. Along with a few other minor changes, I now had the working Servo_easycomm.ino! At this point it worked! However, I quickly discovered a major problem in my approach, The servos I have only move 180 degrees.\n   By Vloeck (Own work) [GFDL (http://www.gnu.org/copyleft/fdl.html) or CC-BY-SA-3.0 (http://creativecommons.org/licenses/by-sa/3.0/)], via Wikimedia Commons\nAs I figured out, there are 360 degrees in a circle. This means that my tracker can only track a satellite moving through two quadrants of the compass. For the most part it\u0026rsquo;s not a big deal, just a small inconvenience. Most satellites only move through two quadrants, and a most of those only move through 2 and 3 or 1 and 4.\n   The solution is to create 4 different programs. One that sets 90 degrees as North and covers from W to E, one that sets 90 degrees to East and covers from North to South, etc. Then, every time I want to track a satellite I just have to load on the correct program and position the tracker so that at 90 degrees it\u0026rsquo;s pointing in the correct direction. Of course, Gpredict doesn\u0026rsquo;t know that there are 4 separate programs. To accommodate this I used the map() function of arduino heavily. This function takes a variable from one range of numbers to another, perfect for what I\u0026rsquo;m doing. For example, the program for North, Servo_easycomm_N.ino, has to take inputs from 270 degrees to 90 degrees, and turn them into 0 to 180 degrees for the servo. \u0026lt;![CDATA[ void servo_move(int stepAz, int stepEl){ int xmape; int xmapr; // map the range of angles to the servo xmape = map(stepEl, 0, 90, 1425, 2400); elservo.writeMicroseconds(xmape); // translate azimuth angles // make 0 degrees pointing north //Serial.println(stepAz); if ((stepAz \u0026gt;= 270) \u0026amp;\u0026amp; (stepAz \u0026lt;= 359)){ //quadrant 2 xmapr = map(stepAz, 270, 359, 2300, 1400); roservo.writeMicroseconds(xmapr); } else if((stepAz \u0026gt;= 0) \u0026amp;\u0026amp; (stepAz \u0026lt;= 90)){ // quadrant 1 xmapr = map(stepAz, 0, 90, 1400, 500); roservo.writeMicroseconds(xmapr); } } ]]\u0026gt;\nOnce I figured that out, it was pretty easy. The steps to actually tracking a satellite:\n Open Gpredict and figure out which quadrants the satellite is going through Load the correct program into the arduino. Wait for the program upload to complete. Point the antenna in the correct direction. Run \u0026ldquo;rotctld -m 202 -s 19200 -r /dev/ttyUSB0\u0026rdquo; Open the antenna control in Gpredict. Engage the interface. Select the satellite. Click \u0026ldquo;Track\u0026rdquo;  See, simple!\nAt this point it can actually track satellites:\nFrom a vice on my floor. Not very useful.\nI also implemented the analog feedback into the SatNOGS code. SatNOGS steppers use \u0026ldquo;step2deg(ELstepper.currentPosition())\u0026rdquo; to get the current position of their motors in degrees and then print it out where necessary in the code. Gpredict than reads those values and displays the current location of the antenna as a crosshair on the compass.\nI just made my own functions to return the elevation or azimuth degrees based on their current analog reading, and then put that in place of the stepper code.\n\u0026lt;![CDATA[ int degel(){ int position; int degree; // elevation feedback position = analogRead(elfeedbackPin); // my servo reads 264 at 90 degrees // which is 0 degrees of elevation degree = map(position, 264, 425, 90, 0); return degree; } ]]\u0026gt;\nNow Gpredict shows where my antenna is actually pointing!\n   The other half of the equation is the radio. I used the ever-popular (~$15) RTL-SDR with GQRX as the software. As a satellite moves towards and away from you the frequency changes slightly due to the doppler effect. Luckily, Gpredict can easily interface with GQRX to control the tuning frequency. Gpredict also comes with most satellite frequencies built-in.\nHardware Again # As I was writing the first part of this post, the pan and tilt setup arrived.\n   Even though I\u0026rsquo;m pretty sure my setup would have worked, the hardware for the pan and tilt was way better than anything I could have built. The servos are exactly the same, so I switched my modified servos in for the included ones and started using that setup instead. This also required some code tweaking and the elevation control was reversed, but that\u0026rsquo;s easy.\nNext I started to consider how I wanted to mount the whole setup to a tripod. The easiest way I could think of was to buy some nuts and epoxy one of them to the side of the azimuth servo. The standard tripod mount is 1/40-20, which can be found at any hardware store in the US.\n      There\u0026rsquo;s probably a better way to do this, but it worked well enough. I also drilled a hole in the bracket for the extra pin on the tripod mount, to keep it level.\n   (shown undrilled in this photo)\n   Going through my junk, I found a circular bubble level which is very helpful when you want to know if something is well\u0026hellip; level.\n   After that it was time to figure out a battery solution. For a couple of days I tried to get one of those external usb power packs working, but it would always shut itself off eventually. I gave up on that for now and bought some AA battery holders. Four AA batteries is more than enough for these servos. In the future I might try a setup with 18650 batteries instead.\n   I verified that the 4 AA setup actually works, and then got to wiring everything together. My plan was to cut off all the connectors and replace the servo ones with standard computer power supply connectors, which I have a ton of.\n   This worked pretty well, and I even used some fan connectors for the arduino and battery connections.\n   I also covered most of the wiring in wire loom to hide the mess. Then it was time for more zip ties! Simply zip tie everything to a tripod!\n   RTL-SDR in altoids tin, with radioshack FM radio filter.\n   Now the setup is complete and basically portable. Time for field testing.\nField Test # After waiting for the lightning and rain to stop, I picked a satellite that I knew was always transmitting (NOAA 18) and drove to an empty parking lot to test it out.\n         It worked! Unfortunately I didn\u0026rsquo;t have GQRX set up correctly, so I didn\u0026rsquo;t get an actual image from the pass, but it tracked almost perfectly.\nHere\u0026rsquo;s a video I took of it, sped up 40 times:\nOne problem I had was the Gpredict rotator control was only set to update when the antenna was 5 degrees off, so it didn\u0026rsquo;t update as often as I would have liked. Later, I set it to 1 degree. The wind also messes with the tape measure elements pretty badly, but I don\u0026rsquo;t think it was that big of a problem.\nI tracked some of the XW-2 satellites after that, and they all showed up as well.\n   So, is it useful at all? Probably not. It is cool and I learned a lot, but actually driving somewhere, setting it up correctly (which involves reprogramming the arduino for every satellite), and then sitting around is pretty much the opposite of useful.\nMost people want satellite trackers so that they can put them outside and then control the antenna from inside, which someone probably can\u0026rsquo;t do with mine unless they live in a really nice place (or build a radome). However, it could be useful for a small number of people who have covered balconies or porches. It wouldn\u0026rsquo;t receive the full effect of the weather and they wouldn\u0026rsquo;t be able to get more than 180 degrees from a balcony anyways.\n Also, if you try to transmit the interference will kill the servos while you\u0026rsquo;re transmitting, so it\u0026rsquo;s useless for that (although that could probably be fixed).\nNot counting things I already had (SDR, tripod, arduino, etc), the total comes for me came to around $60, which is almost $25, right? Really though, I think if someone wanted to build this project they could do it for around $25. Just buy the pre-made pan and tilt and zip tie an antenna to it.\nWhere will this project go next? I\u0026rsquo;m going to try to modify the azimuth servo to be full-rotation. I\u0026rsquo;m also planning on building another antenna for the 435 MHz region. Or maybe I\u0026rsquo;ll bin the whole thing and build a SatNOGS rotator.\nComplete source code # Comments: # Hi, I\u0026rsquo;m Eleftherios from the SatNOGS team, we \u0026hellip; # elkos - May 4, 2016\nHi, I\u0026rsquo;m Eleftherios from the SatNOGS team, we are glad you found our code useful and we are looking forward to join our community and see more stuff from you. :)\n#### Hi, nice project. A compass module (+gyro) could b... [satman](https://www.blogger.com/profile/01419290676631576689 \"noreply@blogger.com\") - May 4, 2016 Hi, nice project. A compass module (+gyro) could be an option instead for measuring the full rotation instead of a rotary encoder. Have you experienced any electromagnetic-noise because of your servos etc.? The good old aluminium foil could do a good option for shielding the servo otherewise. If your antenna has an azimut of 180 degree you could just tilt it over to the other side, that could solve your problem, but you would probably have a short signal loss.\nHow powerfull is the servo setup? Could it handle a 0.5 kg antenna?\nCongrats on that nice project.\n#### Hice job, congrats ! Exactly what I\\`m looking for,... [Vic YO4TNV](https://www.blogger.com/profile/09495312386868679551 \"noreply@blogger.com\") - May 5, 2016 Hice job, congrats ! Exactly what I`m looking for, linux, gpredict and arduino i will try to build it too . 73 de YO4TNV !\n#### Thanks! I did think of using a compass, but not t... [Paul Schow](https://www.blogger.com/profile/02139879554145337777 \"noreply@blogger.com\") - May 1, 2016 Thanks!\nI did think of using a compass, but not to detect the rotation. I\u0026rsquo;ll have to look into that!\nit doesn\u0026rsquo;t seem like noise is a problem, but shielding would probably be a good idea anyways.\nI\u0026rsquo;m not sure exactly how much weight they can handle. I think balance is a big part of that too.\n#### Great Article with components that can be acquired... [Chief Cook and Bottle Washer](https://www.blogger.com/profile/18311227368721846511 \"noreply@blogger.com\") - Jun 6, 2016 Great Article with components that can be acquired in more remote areas of the world.\nThat said, I can\u0026rsquo;t see any images as your host, Blogspot, is blocked by many authoritarian governments as former countrymen use it as a platform for political protest.\nSo it\u0026rsquo;s off to Cambodia where almost everything is uncensored.\n#### Hi again Today I came across this motor: http://ww... [satman](https://www.blogger.com/profile/01419290676631576689 \"noreply@blogger.com\") - Jun 2, 2016 Hi again\nToday I came across this motor: http://www.dx.com/p/40rpm-12v-encoder-motor-dc-turbo-worm-gear-motor-w-self-lock-434055?TC=USD\u0026en20160526newarrivals#.V1b7eb7oSzk\nI belive it could just fit your needs.\n#### Can you track the signal strength, that is given y... [PhilCobbin](https://www.blogger.com/profile/00752686085586715309 \"noreply@blogger.com\") - Aug 1, 2016 Can you track the signal strength, that is given you rotate about the satellite\u0026rsquo;s location can you measure the signal strength as a function of the tilt settings?\n#### I haven't experimented with that at all, but i... [Paul Schow](https://www.blogger.com/profile/02139879554145337777 \"noreply@blogger.com\") - Aug 1, 2016 I haven\u0026rsquo;t experimented with that at all, but it would probably be possible. Most of the drone antenna trackers (FPV) use a similar system.\n#### Nice work :-) I actually did something similar t... [thazlett](https://www.blogger.com/profile/18187536925372319389 \"noreply@blogger.com\") - Sep 1, 2016 Nice work :-)\nI actually did something similar to this 3 years ago. I used the same pan tilt servo kit you appear to have used. As for code I only got as far as controlling the servos from the serial console (using WASD for control). After that I had other things going on and the project took a back seat. I have lost some of it now which is a shame.\nHere are videos of my old rig which is now probably in my boxes of junk. I was testing the limits of those servos I think:\nhttps://www.youtube.com/watch?v=OotKcJFz7SQ\nhttps://www.youtube.com/watch?v=8Miy1syfaPk\nI have recently been looking to pick it up again. What you have done here is exactly what I was aiming to do 3 years ago. I\u0026rsquo;m happy to see I wasn\u0026rsquo;t the only one who attempted it. 3 years ago I remember finding information on it quite difficult. I knew little about servos and it was also the first time I used an arduino. So it was a huge learning curve for me also. I also ran into that same issue with the panning servo.\nThis has sparked my interest once again :-)\n","date":"12 May 2016","permalink":"/2016/05/25-satellite-tracker.html","section":"Posts","summary":"After building my QFH antenna, I became more interested in satellite communications.","title":"$25 Satellite Tracker"},{"content":"","date":"12 May 2016","permalink":"/","section":"Paul's Projects","summary":"","title":"Paul's Projects"},{"content":"","date":"12 May 2016","permalink":"/posts/","section":"Posts","summary":"","title":"Posts"},{"content":"","date":"1 January 0001","permalink":"/categories/","section":"Categories","summary":"","title":"Categories"},{"content":"","date":"1 January 0001","permalink":"/tags/","section":"Tags","summary":"","title":"Tags"}]